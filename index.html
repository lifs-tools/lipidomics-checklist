<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<script language="javascript">
/*
var lipidomics_forms_content = [{"title": "Overall study design",
  "content": [
    {"label": "Title of the Study",
     "name": "study-title",
     "type": "text",
     "required": 1,
     "value": "",
     "description": "To whom correspondence should be addressed?"
     },
    {"name": "workflow-type",
     "type": "hidden",
     "value": "di"
     },
    {"label": "Select your weapons",
     "name": "whatever",
     "type": "multiple",
     "required": 1,
     "choice": [
        {"name": "12345",
         "label": "This is the first item",
         "value": 1
         },
        {"name": "321",
         "label": "This is the second item",
         "value": 0
         },
        {"name": "32145",
         "label": "This is the third item",
         "value": 1
         },
        {"name": "321458",
         "label": "This is the third item",
         "value": 1
         },
        {"name": "321457",
         "label": "This is the third item",
         "value": 1
         },
        {"name": "321456",
         "label": "This is the third item",
         "value": 1
         },
        {"name": "321455",
         "label": "This is the third item",
         "value": 1
         },
        {"name": "321454",
         "label": "This is the third item",
         "value": 1
         },
        {"name": "321453",
         "label": "This is the third item",
         "value": 1
         },
        {"name": "321452",
         "label": "This is the third item",
         "value": 1
         },
        {"name": "321451",
         "label": "This is the third item",
         "value": 1
         },
        {"name": "3214521",
         "label": "This is the third item",
         "value": 1
         },
        {"name": "3214512",
         "label": "This is the third item",
         "value": 1
         },
        {"name": "3214522",
         "label": "This is the third item",
         "value": 1
         },
        {"name": "3214511",
         "label": "This is the third item",
         "value": 1
         }
     ],
     "description": "To whom correspondence should be addressed?"
     },
    {"label": "All for combo",
     "name": "mlp",
     "type": "select",
     "choice": [
        {"name": "mrait",
         "label": "This is the first item",
         "value": 0
         },
        {"name": "atl34",
         "label": "This is the second item",
         "value": 1
         },
        {"name": "upga",
         "label": "This is the third item",
         "value": 0
         }
     ],
     "description": "To whom correspondence should be addressed?",
     "condition": "32145=1"
     },
     {"label": "Title of the Study",
     "name": "study-title2",
     "type": "text",
     "required": 0,
     "value": "Foo",
     "description": "To whom correspondence should be addressed?"
     }
     
  ]
},{"title": "Internal standards",
  "content": [
    {"label": "The internal standards",
     "name": "allright",
     "type": "text",
     "required": 1,
     "value": "What are you talking about",
     "description": "To whom correspondence should be addressed?"
     },
    {"label": "Temparature",
     "name": "temp",
     "type": "number",
     "min": 1,
     "max": 20,
     "value": 5,
     "step": 1,
     "description": "What is your favorite temparature?",
     "condition": "workflow-type='di'"
     }
  ]
}
];
*/


lipidomics_forms_content = [{'title': '-', 'content': [{'label': 'Sample set name', 'name': '25', 'type': 'text', 'required': 1, 'value': '', 'description': 'Name of the sample set.'}, {'label': 'Sample origin', 'name': '23', 'type': 'select', 'required': 0, 'choice': [{'name': '23-1', 'label': 'Human', 'value': 0}, {'name': '23-2', 'label': 'Mouse', 'value': 0}, {'name': '23-3', 'label': 'Bacteria', 'value': 0}, {'name': '23-6', 'label': 'Fungi', 'value': 0}, {'name': '23-5', 'label': 'Plants', 'value': 0}, {'name': '23-4', 'label': 'Food', 'value': 0}, {'name': '23-7', 'label': 'Other', 'value': 0}], 'description': 'Specify the type of origin of the sample material.'}, {'label': 'Other sample origin', 'name': '24', 'type': 'text', 'required': 1, 'value': '', 'description': 'Specify the other sample origin.', 'condition': '23-7=1'}, {'label': 'Sample type', 'name': '17', 'type': 'select', 'required': 0, 'choice': [{'name': '17-1', 'label': 'Plasma', 'value': 0}, {'name': '17-2', 'label': 'Serum', 'value': 0}, {'name': '17-3', 'label': 'Cells', 'value': 0}, {'name': '17-5', 'label': 'Tissues (e.g., liver, heart, brain)', 'value': 0}, {'name': '17-6', 'label': 'Urine', 'value': 0}, {'name': '17-7', 'label': 'Feces', 'value': 0}, {'name': '17-8', 'label': 'Other solid material', 'value': 0}, {'name': '17-9', 'label': 'Other liquid material', 'value': 0}], 'description': 'Specify the type of the sample material.'}, {'label': 'Other sample type', 'name': '22', 'type': 'text', 'required': 1, 'value': '', 'description': 'Which other sample type was used?', 'condition': '17-8=1'}, {'label': 'Perfusion', 'name': '3', 'type': 'select', 'required': 0, 'choice': [{'name': '3-1', 'label': 'Yes', 'value': 0}, {'name': '3-2', 'label': 'No', 'value': 1}], 'description': '', 'condition': '17-5=1'}, {'label': 'Provided information', 'name': '30', 'type': 'multiple', 'required': 0, 'choice': [{'name': '30-1', 'label': 'Time to separate plasma/serum (min)', 'value': 0}, {'name': '30-2', 'label': 'Time to freeze (min)', 'value': 0}, {'name': '30-3', 'label': 'Storage time (month)', 'value': 0}, {'name': '30-4', 'label': 'Freeze-thaw cycles', 'value': 0}], 'description': 'Which information is provided?'}, {'label': 'Time to separate plasma/serum (min)', 'name': '4', 'required': 1, 'value': 0, 'description': 'Time from drawing the sample until centrifugation.', 'min': 0.0, 'condition': '17-1=1&30-1=1|17-2=1&30-1=1'}, {'label': 'Temperature handling original sample', 'name': '6', 'type': 'select', 'required': 0, 'choice': [{'name': '6-1', 'label': '4-8 °C', 'value': 0}, {'name': '6-5', 'label': 'Room temperature', 'value': 0}, {'name': '6-6', 'label': '-20 °C', 'value': 0}, {'name': '6-3', 'label': 'Dry ice', 'value': 0}, {'name': '6-4', 'label': 'N2', 'value': 0}, {'name': '6-7', 'label': 'Unknown', 'value': 0}], 'description': 'Temperature until freezing or extraction.'}, {'label': 'Instant sample preparation', 'name': '5', 'type': 'select', 'required': 0, 'choice': [{'name': '5-1', 'label': 'Yes', 'value': 0}, {'name': '5-2', 'label': 'No', 'value': 1}], 'description': 'Lipid extraction was performed instantly after sample collection?'}, {'label': 'Time to freeze (min)', 'name': '7', 'required': 1, 'value': 0, 'description': 'Time until freezing of sample.', 'min': 0.0, 'condition': '30-2=1'}, {'label': 'Snap freezing in liquid N2', 'name': '8', 'type': 'select', 'required': 0, 'choice': [{'name': '8-1', 'label': 'Yes', 'value': 0}, {'name': '8-2', 'label': 'No', 'value': 1}], 'description': 'Was liquid nitrogen used for initial freezing?', 'condition': '30-2=1'}, {'label': 'Storage temperature', 'name': '9', 'type': 'select', 'required': 0, 'choice': [{'name': '9-1', 'label': '-80 °C', 'value': 0}, {'name': '9-2', 'label': 'Liquid nitrogen', 'value': 0}, {'name': '9-3', 'label': '-20 °C', 'value': 0}, {'name': '9-5', 'label': '4-8 °C', 'value': 0}, {'name': '9-4', 'label': 'Room temperature', 'value': 1}], 'description': 'Temperature the samples stored until sample preparation.'}, {'label': 'Storage time (month)', 'name': '10', 'required': 1, 'value': 0, 'description': 'Time of sample storage until lipid extraction', 'min': 0.0, 'condition': '30-3=1'}, {'label': 'Freeze-thaw cycles', 'name': '11', 'required': 1, 'value': 0, 'description': 'How many freeze-thaw cycles underwent the sample?', 'min': 0.0, 'condition': '30-4=1'}, {'label': 'Additives', 'name': '12', 'type': 'select', 'required': 0, 'choice': [{'name': '12-1', 'label': 'BHT', 'value': 0}, {'name': '12-2', 'label': 'lipase Inhibitors', 'value': 0}, {'name': '12-3', 'label': 'None', 'value': 1}, {'name': '12-4', 'label': 'Other', 'value': 0}], 'description': 'Were the samples stored with additional preservenats or in buffers/solvents?\r\n\r\n\r\n\r\n'}, {'label': 'Other additives', 'name': '19', 'type': 'text', 'required': 1, 'value': '', 'description': 'Which other additives were used?', 'condition': '12-4=1'}, {'label': 'Were samples stored under inert gas?', 'name': '13', 'type': 'select', 'required': 0, 'choice': [{'name': '13-1', 'label': 'Yes', 'value': 0}, {'name': '13-2', 'label': 'No', 'value': 1}], 'description': ''}, {'label': 'Additional preservation methods', 'name': '28', 'type': 'select', 'required': 0, 'choice': [{'name': '28-1', 'label': 'Yes', 'value': 0}, {'name': '28-2', 'label': 'No', 'value': 1}], 'description': 'Were additional preservation methods used?'}, {'label': 'Type of preservation method', 'name': '29', 'type': 'text', 'required': 1, 'value': '', 'description': 'Which preservation method was used?', 'condition': '28-1=1'}, {'label': 'Biobank samples', 'name': '15', 'type': 'select', 'required': 0, 'choice': [{'name': '15-1', 'label': 'Yes', 'value': 0}, {'name': '15-2', 'label': 'No', 'value': 1}], 'description': 'Were the samples received from a biobank?'}, {'label': 'Sample homogenization', 'name': '14', 'type': 'select', 'required': 0, 'choice': [{'name': '14-1', 'label': 'Yes', 'value': 0}, {'name': '14-2', 'label': 'No', 'value': 1}], 'description': 'Was the sample homogenized prior lipid extraction?', 'condition': '17-5=1|17-8=1'}, {'label': 'Sample homogenization solvent', 'name': '16', 'type': 'select', 'required': 0, 'choice': [{'name': '16-1', 'label': 'Water', 'value': 0}, {'name': '16-2', 'label': 'Methanol', 'value': 0}, {'name': '16-3', 'label': 'Isopropanol', 'value': 0}, {'name': '16-5', 'label': 'Water/Methanol=1/1 (vol./vol.)', 'value': 0}, {'name': '16-4', 'label': '70% Isopropanol', 'value': 0}, {'name': '16-6', 'label': 'Ethanol', 'value': 0}, {'name': '16-7', 'label': 'Other', 'value': 0}], 'description': 'Which solvent was used for sample homogenization?', 'condition': '17-5=1&14-1=1|17-8=1&14-1=1'}, {'label': 'Other sample homogenization solvent', 'name': '26', 'type': 'text', 'required': 1, 'value': '', 'description': 'Which other sample homogenization solvent was used?', 'condition': '16-7=1'}]}];


var field_map = {};
var dom_field_map = {};
var field_conditions = {};
var field_visible = {};
var form_pages = [];
var dom_form_pages = [];
var current_page = 0;
var required_messages = {};
var dom_text_fields = {};
var form_enabled = true;


function load_data(){
    field_map = {};
    dom_field_map = {};
    field_conditions = {};
    field_visible = {};
    form_pages = [];
    dom_form_pages = [];
    current_page = 0;
    required_messages = {};
    dom_text_fields = {};
    form_enabled = true;
    
    check_fields = {};
    for (page of lipidomics_forms_content){
        for (field of page["content"]){
            // add field info into field map
            if (!("type" in field) || !("name" in field)) continue;
            var field_name = field["name"];
            
            if (field_name in field_map){
                alert("Field with name \"" + field_name + "\" appears to be twice.");
                form_enabled = false;
            }
            field_map[field_name] = field;
            if ((field["type"] == "select" || field["type"] == "multiple") && ("choice" in field)){
                for (choice of field["choice"]){
                    if ("name" in choice){
                        var choice_name = choice["name"];
                        if (choice_name in field_map){
                            alert("Choice with name \"" + choice_name + "\" appears to be twice.");
                            form_enabled = false;
                        }
                        field_map[choice["name"]] = choice;
                    }
                }
            }
            
            // check for any logical conditions
            if (!("condition" in field) || field["condition"].length == 0) continue;
            
            check_fields[field_name] = [];
            var condition = [];
            for (condition_and of field["condition"].split("|")){
                var conjunction = [];
                for (con of condition_and.split("&")){
                    var single_condition = (con.search("!=") != -1) ? con.split("!=") : con.split("=");
                    
                    if (single_condition.length != 2){
                        alert("Corrupted condition \"" + field["condition"] + "\" in field \"" + field_name + "\".");
                        form_enabled = false;
                        continue;
                    }
                        
                    var key = single_condition[0];
                    var operator = "=";
                    var value = single_condition[1];
                        
                    var l = value.length;
                    
                    if (value[0] === "'" && value[l - 1] === "'"){
                        value = value.substring(1, l - 1);
                    }
                    else {
                        // check if value is a number
                        value = parseFloat(value);
                        if (isNaN(value)){
                            alert("Corrupted condition \"" + field["condition"] + "\" in field \"" + field_name + "\".");
                            form_enabled = false;
                            continue;
                        }
                    }
                    check_fields[field_name].push(key);
                    conjunction.push([key, operator, value]);
                    
                    
                }
                condition.push(conjunction);
            }
            field_conditions[field["name"]] = condition;
        }
    }
    // check if all required fields are actually present
    for (field_name in check_fields){
        if (!form_enabled) break;
        for (required_field of check_fields[field_name]){
            if (!(required_field in field_map)){
                alert("Error: required field \"" + required_field + "\" by field \"" + field_name + "\" is not in form.");
                form_enabled = false;
                break;
            }
        }
    }
    

    for (field_name in field_map){
        field_visible[field_name] = true;
    }
    
    var form_viewer = document.getElementById("form-viewer");
    var page_cnt = 0;
    for (page of lipidomics_forms_content){
        var obj_page = document.createElement("div");
        obj_page.className = "lipidomics-forms-page";
        dom_form_pages.push(obj_page);
        
        var forms_in_page = [];
        form_pages.push(forms_in_page);
        
        
        // Status decorator
        if (lipidomics_forms_content.length > 1){
            var obj_status = document.createElement("div");
            obj_status.className = "lipidomics-forms-status";
            obj_page.append(obj_status);
            
            var obj_status_text = document.createElement("div");
            obj_status_text.className = "lipidomics-forms-status-text";
            obj_status_text.innerHTML = "<font size='+1'>" + (("title" in page) ? page["title"] : "X") + " - Page " + (page_cnt + 1) + " of " + lipidomics_forms_content.length + "</font>";
            obj_status.append(obj_status_text);
            
            var obj_status_bar = document.createElement("div");
            obj_status_bar.className = "lipidomics-forms-status-bar";
            obj_status.append(obj_status_bar);
            
            var obj_status_bar_progress = document.createElement("div");
            obj_status_bar_progress.className = "lipidomics-forms-status-bar-progress";
            obj_status_bar_progress.style.width = ((page_cnt + 1) / lipidomics_forms_content.length * 100) + "%";
            obj_status_bar.append(obj_status_bar_progress);
        }
        
        
        for (field of page["content"]){
            if (!("type" in field) || !("name" in field)) continue;
            var field_name = field["name"];

            var obj = document.createElement("div");
            obj.className = "lipidomics-forms-field";
            dom_field_map[field_name] = obj;
            obj_page.append(obj);
            forms_in_page.push(field_name);
            
            if (field["type"] == "text"){
                if (!("label" in field)) continue;
                if (!("value" in field)) field["value"] = "";
                if (!("description" in field)) field["description"] = "";
                
                // Adding the title of the field
                var obj_title = document.createElement("div");
                obj_title.className = "lipidomics-forms-field-title";
                obj_title.innerHTML = "<b>" + field["label"] + "</b>";
                if (("required" in field) && field["required"] == 1){
                    obj_title.innerHTML += " <font color='red'>*</font>";
                }
                obj.append(obj_title);
                
                // Adding the text field of the field
                var obj_content = document.createElement("div");
                obj_content.className = "lipidomics-forms-field-content";
                var obj_input = document.createElement("input");
                obj_input.className = "lipidomics-forms-input";
                obj_input.type = "text";
                obj_input.value = field["value"];
                obj_input.content = field;
                obj_input.field_name = field_name;
                obj_input.setAttribute('onchange','update_text(this);');
                obj_content.append(obj_input);
                obj.append(obj_content);
                dom_text_fields[field_name] = obj_input;
                
                // Adding description of the field if present
                if (field["description"].length > 0){
                    var obj_description = document.createElement("div");
                    obj_description.className = "lipidomics-forms-field-description";
                    obj_description.innerHTML = field["description"];
                    obj.append(obj_description);
                }
                
                var obj_required = document.createElement("div");
                obj_required.className = "lipidomics-forms-required-message";
                obj_required.innerHTML = "This field is required.";
                obj_required.style.display = "none";
                obj.append(obj_required);
                required_messages[field_name] = obj_required;
            }
            
            if (field["type"] == "number"){
                if (!("label" in field)) continue;
                if (!("value" in field)) field["value"] = "";
                if (!("description" in field)) field["description"] = "";
                
                // Adding the title of the field
                var obj_title = document.createElement("div");
                obj_title.className = "lipidomics-forms-field-title";
                obj_title.innerHTML = "<b>" + field["label"] + "</b>";
                if (("required" in field) && field["required"] == 1){
                    obj_title.innerHTML += " <font color='red'>*</font>";
                }
                obj.append(obj_title);
                
                // Adding the text field of the field
                var obj_content = document.createElement("div");
                obj_content.className = "lipidomics-forms-field-content";
                var obj_input = document.createElement("input");
                obj_input.className = "lipidomics-forms-number";
                obj_input.type = "number";
                obj_input.value = field["value"];
                if ("min" in field) obj_input.min = field["min"];
                if ("max" in field) obj_input.min = field["max"];
                if ("step" in field) obj_input.min = field["step"];
                obj_input.content = field;
                obj_input.field_name = field_name;
                obj_input.setAttribute('onchange','update_text(this);');
                obj_content.append(obj_input);
                obj.append(obj_content);
                dom_text_fields[field_name] = obj_input;
                
                // Adding description of the field if present
                if (field["description"].length > 0){
                    var obj_description = document.createElement("div");
                    obj_description.className = "lipidomics-forms-field-description";
                    obj_description.innerHTML = field["description"];
                    obj.append(obj_description);
                }
                
                var obj_required = document.createElement("div");
                obj_required.className = "lipidomics-forms-required-message";
                obj_required.innerHTML = "This field is required.";
                obj_required.style.display = "none";
                obj.append(obj_required);
                required_messages[field_name] = obj_required;
            }
            
            else if (field["type"] == "multiple"){
                if (!("label" in field) || !("choice" in field)) continue;
                if (!("description" in field)) field["description"] = "";
                
                
                // Adding the title of the field
                var obj_title = document.createElement("div");
                obj_title.className = "lipidomics-forms-field-title";
                obj_title.innerHTML = "<b>" + field["label"] + "</b>";
                if (("required" in field) && field["required"] == 1){
                    obj_title.innerHTML += " <font color='red'>*</font>";
                }
                obj.append(obj_title);
                
                // Adding the checkbox fields of the field
                var obj_content = document.createElement("div");
                obj_content.className = "lipidomics-forms-field-content";
                var obj_ul = document.createElement("ul");
                obj_ul.className = "lipidomics-forms-multiple";
                for (choice of field["choice"]){
                    if (!("name" in choice)) continue;
                    if (!("label" in choice)) choice["label"] = "Null";
                    if (!("value" in choice)) choice["value"] = 0;
                    
                    var obj_li = document.createElement("ul");
                    obj_ul.append(obj_li);
                    obj_li.className = "lipidomics-forms-li";
                    
                    var obj_input = document.createElement("input");
                    obj_li.append(obj_input);
                    
                    obj_input.type = "checkbox";
                    obj_input.content = choice;
                    obj_input.field_name = field_name;
                    if (choice["value"] == 1) obj_input.checked = true;
                    obj_input.setAttribute('onchange','update_choice(this);');
                    
                    var obj_label = document.createElement("label");
                    obj_li.append(obj_label);
                    obj_label.innerHTML = choice["label"];
                    
                }
                obj_content.append(obj_ul);
                obj.append(obj_content);
                
                // Adding description of the field if present
                if (field["description"].length > 0){
                    var obj_description = document.createElement("div");
                    obj_description.className = "lipidomics-forms-field-description";
                    obj_description.innerHTML = field["description"];
                    obj.append(obj_description);
                }
                
                var obj_required = document.createElement("div");
                obj_required.className = "lipidomics-forms-required-message";
                obj_required.innerHTML = "This field is required.";
                obj_required.style.display = "none";
                obj.append(obj_required);
                required_messages[field_name] = obj_required;
            }
            
            else if (field["type"] == "select"){
                if (!("label" in field) || !("choice" in field)) continue;
                if (!("description" in field)) field["description"] = "";
                
                
                // Adding the title of the field
                var obj_title = document.createElement("div");
                obj_title.className = "lipidomics-forms-field-title";
                obj_title.innerHTML = "<b>" + field["label"] + "</b>";
                if (("required" in field) && field["required"] == 1){
                    obj_title.innerHTML += " <font color='red'>*</font>";
                }
                obj.append(obj_title);
                
                // Adding the checkbox fields of the field
                var obj_content = document.createElement("div");
                obj_content.className = "lipidomics-forms-field-content";
                var obj_select = document.createElement("select");
                obj_select.className = "lipidomics-forms-select";
                obj_select.content = field;
                obj_select.field_name = field_name;
                var selectedIndex = 0;
                var cnt = 0;
                for (choice of field["choice"]){
                    if (!("name" in choice)) continue;
                    if (!("label" in choice)) choice["label"] = "Null";
                    if (!("value" in choice)) choice["value"] = 0;
                    
                    var obj_option = document.createElement("option");
                    obj_select.append(obj_option);
                    if (choice["value"] == 1) selectedIndex = cnt;
                    
                    obj_option.innerHTML = choice["label"];
                    cnt++;
                }
                obj_select.selectedIndex = selectedIndex;
                obj_select.setAttribute('onchange','update_select(this);');
                obj_content.append(obj_select);
                obj.append(obj_content);
                
                
                // Adding description of the field if present
                if (field["description"].length > 0){
                    var obj_description = document.createElement("div");
                    obj_description.className = "lipidomics-forms-field-description";
                    obj_description.innerHTML = field["description"];
                    obj.append(obj_description);
                }
                
                var obj_required = document.createElement("div");
                obj_required.className = "lipidomics-forms-required-message";
                obj_required.innerHTML = "This field is required.";
                obj_required.style.display = "none";
                obj.append(obj_required);
                required_messages[field_name] = obj_required;
            }
        }
        obj_page.style.display = (page_cnt == 0) ? "block" : "none";
            
        if (page_cnt > 0){ 
            var obj_prev = document.createElement("button");
            obj_prev.className = "submit-button";
            obj_prev.disabled = !form_enabled;
            obj_prev.innerHTML = "Previous & Save";
            obj_prev.setAttribute('onclick','change_page(-1);');
            obj_page.append(obj_prev);
        }
            
        var obj_next = document.createElement("button");
        obj_next.className = "submit-button";
        obj_next.disabled = !form_enabled;
        if (page_cnt < lipidomics_forms_content.length - 1){
            obj_next.innerHTML = "Next & Save";
            obj_next.setAttribute('onclick','change_page(1);');
        }
        else {
            obj_next.innerHTML = "Submit";
            obj_next.setAttribute('onclick','submit_form();');
        }
        obj_page.append(obj_next);
        
        form_viewer.append(obj_page);
        
        page_cnt++;
    }
    check_conditions();
    change_page(0);
}





function update_text(form){
    if (!form_enabled) return;
    
    var field_name = form.content["name"];
    form.content["value"] = form.value;
    required_messages[field_name].style.display = "none";
    form.style.border = "1px solid #ccc";
    check_conditions();
}



function update_choice(form){
    if (!form_enabled) return;
    
    var field_name = form.field_name;
    form.content["value"] = form.checked ? 1 : 0;
    required_messages[field_name].style.display = "none";
    check_conditions();
}



function update_select(form){
    if (!form_enabled) return;
    
    var field_name = form.content["name"];
    var l = form.content["choice"].length;
    for (var i = 0; i < l; ++i){
        form.content["choice"][i]["value"] = (i == form.selectedIndex) ? 1 : 0;
    }
    required_messages[field_name].style.display = "none";
    check_conditions();
}


function check_conditions(){
    if (!form_enabled) return;

    for (field_name in field_conditions){
        field_visible[field_name] = false;
        for (condition_and of field_conditions[field_name]){
            var condition_met = true;
            for (single_condition of condition_and){
                var key = single_condition[0];
                var operator = single_condition[1];
                var value = single_condition[2];
                condition_met &= (operator == "=" && field_map[key]["value"] == value) || (operator == "!=" && field_map[key]["value"] != value);
            }
            field_visible[field_name] |= condition_met;
        }
        dom_field_map[field_name].style.display = field_visible[field_name] ? "block" : "none";
    }
}


function check_requirements(){
    if (!form_enabled) return false;
    
    var first_required = null;
    for (form_name of form_pages[current_page]){
        if (!("required" in field_map[form_name]) || field_map[form_name]["required"] == 0) continue;
        if (!field_visible[form_name]) continue;
        
        if (field_map[form_name]["type"] == "text"){
            if (field_map[form_name]["value"].length > 0) continue;
            
            dom_text_fields[form_name].style.border = "1px solid #cc0000";
        }
        else if (field_map[form_name]["type"] == "multiple"){
            var something_selected = false;
            for (choice of field_map[form_name]["choice"]){
                something_selected |= choice["value"] != 0;
            }
            if (something_selected) continue;
        }
        
        
        if (first_required == null) first_required = form_name;
        required_messages[form_name].style.display = "block";
    }
    
    // move to first required
    if (first_required != null){
        dom_field_map[first_required].scrollIntoView();
    }

    return first_required == null;
}


function change_page(offset){
    if (offset != 0 && !check_requirements()) return;

    current_page = Math.min(Math.max(current_page + offset, 0), lipidomics_forms_content.length - 1);
    var i = 0;
    for (page of dom_form_pages){
        page.style.display = (current_page == i++) ? "block" : "none";
    }
}

function submit_form(){
    if (!form_enabled) return;
    if (!check_requirements()) return;
}



</script>
<style>
.lipidomics-forms-page {
}

.lipidomics-forms-field {
    margin: 0 0 25px 0;
    width: 100%;
}

.lipidomics-forms-field-title {
    margin: 1px 0 1px 0;
}

.lipidomics-forms-field-content {
}

.lipidomics-forms-required-message {
    color: #990000;
}

.lipidomics-forms-input {
    padding: 6px 10px;
    max-width: 60%;
    border: 1px solid #ccc;
    border-radius: 2px;
    width: 100%;
}

.lipidomics-forms-number {
    padding: 6px 10px;
    max-width: 60%;
    border: 1px solid #ccc;
    border-radius: 2px;
    width: 100%;
}

.lipidomics-forms-li {
    padding: 6px 10px;
    max-width: 60%;
    width: 100%;
}

.lipidomics-forms-select {
    padding: 6px 10px;
    max-width: 60%;
    border: 1px solid #ccc;
    border-radius: 2px;
    width: 100%;
    text-transform: none;
    white-space: nowrap;
    background-color: #fff;
}

.lipidomics-forms-multiple {
    list-style: none;
    padding-left: 0;
    margin: 0px 0 0px 0;
}

.lipidomics-forms-field-description {
    font-size: 13px;
    margin: 1px 0 1px 0;
}

.submit-button {
    background-color: #ddd;
    border: 1px solid #ccc;
    cursor: pointer;
    font-size: 0.9em;
    font-weight: 400;
    margin: 0 5px;
    min-width: 90px;
    text-align: center;
    padding: 10px 15px;
}

.submit-button:hover {
    background-color: #eee;
}

.submit-button:active {
    background-color: #ccc;
}

.lipidomics-forms-status {
    margin: 0 0 30px 0;
}

.lipidomics-forms-status-bar {
    background-color: #ddd;
    height: 18px;
    border-radius: 10px;
    overflow: hidden;
    width: 100%;
    margin: 5px 0 0;
    padding: 0 0 0 0;
}

.lipidomics-forms-status-bar-progress {
    background-color: #009900;
    height: 18px;
    border-radius-left: 10px;
    overflow: hidden;
    position: relative;
    left: 0;
    top: 0;
}

</style>
</head>


<body>

<div id="form-viewer">
</div>


</body>
<script language="javascript">
load_data();
</script>
</html>
